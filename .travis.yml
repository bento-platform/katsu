dist: bionic
language: python
python:
  - "3.7"
addons:
  postgresql: "11"
  apt:
    packages:
      - postgresql-11
      - postgresql-contrib-11
before_install:
  - sed -i 's/postgres                                peer/postgres trust/g' /etc/postgresql/11/main/pg_hba.conf
  - sudo systemctl restart postgresql
  - psql -U postgres -p 5433 -d postgres -c "alter user postgres with password 'admin';"
  - sed -i 's/postgres trust/postgres md5/g' /etc/postgresql/11/main/pg_hba.conf
  - sudo systemctl restart postgresql
install:
  - pip install -r requirements.txt
script:
  POSTGRES_USER="postgres" POSTGRES_PASSWORD="admin" POSTGRES_PORT=5433 python3 ./manage.py test
