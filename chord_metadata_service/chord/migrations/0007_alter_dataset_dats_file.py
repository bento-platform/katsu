# Generated by Django 4.2.7 on 2024-01-16 19:06

import json
from django.db import migrations, models

def migrate_dats_json(apps, _schema_editor):
    Dataset = apps.get_model("chord", "Dataset")
    for dataset in Dataset.objects.all():
        dataset.dats_file = json.loads(dataset.dats_string)

def reverse_dats_string(apps, _schema_editor):
    Dataset = apps.get_model("chord", "Dataset")
    for dataset in Dataset.objects.all():
        dataset.dats_string = json.dumps(dataset.dats_file)

class Migration(migrations.Migration):

    dependencies = [
        ('chord', '0006_v4_0_0'),
    ]

    operations = [
        migrations.RenameField(
            model_name='dataset',
            old_name='dats_file',
            new_name='dats_string'
        ),
        migrations.AddField(
            model_name='dataset',
            name='dats_file',
            field=models.JSONField(blank=True, default=dict, help_text='Content of a valid DATS file, in JSON format, that specifies the dataset provenance.'),
        ),
        migrations.RunPython(migrate_dats_json, reverse_code=reverse_dats_string),
        migrations.RemoveField(
            model_name='dataset',
            name='dats_string'
        )
    ]
